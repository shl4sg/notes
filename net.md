#### ARP协议

ARP（Address Resolution Protocol）即地址解析协议， 用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址。

工作原理

每个主机都会有自己的ARP缓存区中建立一个ARP列表，以表示IP地址和MAC地址之间的对应关系。当源主机要发送数据时，首先检测ARP列表中是否对应IP地址的目的主机的MAC地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机发送ARP数据包。

内容:我是IP地址，mac地址，谁是IP地址，mac?
当本网络的所有主机收到该ARP数据包时，首先检查数据包中的IP地址是否是自己的IP地址，如果不是，则忽略该数据包。如果是，则首先从数据包中取出源主机的IP和mac地址写入到ARP列表中，如果以存在，则覆盖。然后将自己的mac地址写入arp响应包中，告诉源主机自己是它想要找的mac地址。源主机收到ARP响应包后，将目的主机的IP和mac地址写入arp列表，并利用此信息发送数据。如果源主机一直没有收到arp响应数据包，表示arp查询失败。

#### 访问网站过程

##### （联网准备过程）



##### 浏览器中输入URL

浏览器要将URL解析为IP地址，解析域名就要用到DNS协议，首先主机会查询DNS的缓存，如果没有就给本地DNS发送查询请求。DNS服务器是基于UDP的，因此会用到UDP协议。

得到IP地址后，浏览器就要与服务器建立一个http连接，因此要用到http协议。http生成一个get请求报文，将该报文传给TCP层处理，所以还会用到TCP协议。如果采用https还会使用ssl协议先对http数据进行加密。

TCP的数据包然后会发送给IP层，用+-

-+到IP协议。IP层通过路由选路，一跳一跳发送到目的地址。当然在一个网段内的寻址是通过以太网协议实现(也可以是其他物理层协议，比如PPP，SLIP)，以太网协议需要直到目的IP地址的物理地址，有需要ARP协议。

DNS查询分为两种方式，一种是递归查询，一种是迭代查询。如果是迭代查询，本地的DNS服务器，向根域名服务器发送查询请求，根域名服务器告知该域名的一级域名服务器，然后本地服务器给该一级域名服务器发送查询请求，然后依次类推直到查询到该域名的IP地址。TCP层如果有需要先将HTTP数据包分片，分片依据MSS（最大报文段长度）。

#### tcp连接建立过程

第一次握手：客户端发送SYN包至服务器，seq为随机值x,并进入SYN_SENT状态，等待服务器确认

第二次握手：服务器收到客户端的SYN包，发送一个ACK包,标志位ack和syn都为1，seq随机值=y,ack=x+1此时服务器进入SYN_RCVD状态

第三次握手：客户端接收到服务器发送的SYN+ACK后，进入ESTABLISHED状态，并发送确认ACK包，ack=y+1服务器接收到客户端ACK后，进入ESTABLISHED状态

ack=对方的syn+1+len

#### tcp连接关闭过程

第一次挥手：主动关闭方发送一个FIN+ACK包并进入FIN_WAIT1状态

第二次挥手：被动关闭方接收到主动关闭方发送的FIN并发送ACK，此时被动关闭方进入CLOSE_WAIT状态；主动关闭方收到被动关闭方的ACK后，进入FIN_WAIT2状态

第三次挥手：被动关闭方发送一个FIN并进入LAST_ACK状态

第四次挥手：主动关闭方收到被动关闭方发送的FIN并发送ACK，此时主动关闭方进入TIME_WAIT状态，经过2MSL(最大段生存期)时间后关闭连接；被动关闭方收到主动关闭方的ACK后，关闭连接