#### ARP协议

ARP（Address Resolution Protocol）即地址解析协议， 用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址。它是网络层协议。

意义：二层的以太网交换设备并不能识别32位的IP地址，它们是以48位以太网地址（就是我们常说的MAC地址）传输以太网数据包的。

工作原理：每个主机都会在缓存区中建立一个ARP列表，存储IP地址和MAC地址之间的对应关系。当源主机要发送数据时，首先检测ARP列表中是否对应IP地址的目的主机的MAC地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机广播ARP请求数据包。

内容:源主机ip地址和mac地址，目标主机ip地址和全0的mac地址。
当本网络的所有主机收到该ARP数据包时，首先检查数据包中的IP地址是否是自己的IP地址，如果不是，则忽略该数据包。如果是，则首先从数据包中取出源主机的IP和mac地址写入到ARP列表中，如果以存在，则覆盖。然后将自己的mac地址写入arp响应包中，告诉源主机自己是它想要找的mac地址。源主机收到ARP响应包后，将目的主机的IP和mac地址写入arp列表，并利用此信息发送数据。如果源主机一直没有收到arp响应数据包，表示arp查询失败。

#### DNS协议

同时占用tcp和udp协议53端口。一般用udp，当数据量少用udp，多用tcp。应用层协议。

递归查询：客户机向dns服务器发送请求，DNS服务器会使用一个准确的查询结果回复给客户机，如果DNS服务器本地没有储存查询的DNS信息，那么它会查询其他的DNS服务器，并将查询结果提交给客户机。

迭代查询：客户机向dns服务器发送请求，如果该服务器本地没有储存查询的DNS信息，那么它会告诉客户机另一台DNS服务器的地址，客户机再向这台DNS服务器查询DNS信息，依次循环直到返回结果。

#### ping与ICMP协议

ping是Packet Internet Groper，因特网包探索器，一个程序。

ICMP是internet控制报文协议，属于网络层协议。它使用ip协议传输。

icmp作用，1、确认IP包是否成功到达目标地址 2、通知在发送过程中IP包被丢弃的原因icmp类型：

1、查询信息类

基于回送请求和回送应答实现的ping程序，一般用于确定某台主机是否可达。

2、差错报文类

IP 路由器无法将 IP 数据包发送给目标地址时，会给发送端主机返回一个目标不可达的 ICMP 消息，消息中包含不可达的具体原因

#### udp协议

用户数据报协议 UDP 只在 IP 的数据报服务之上增加了很少一点的功能，这就是复用和分用的功能以及查错检测的功能。

UDP提供尽最大努力的交付，不保证可靠交付。UDP是面向报文的，对应用层交下来的报文，添加首部后直接向下交付为IP层，既不合并，也不拆分，保留这些报文的边界。UDP常用一次性传输比较少量数据的网络应用。复用和分用，从源主机不同套接字收集数据块，并传送报文，最终正确地将报文分发到正确的套接字。

#### 访问网站过程

##### 浏览器中输入URL

浏览器要将URL解析为IP地址，解析域名就要用到DNS协议，首先主机会查询DNS的缓存，如果没有就给本地DNS发送查询请求。DNS服务器是基于UDP的，因此会用到UDP协议。

得到IP地址后，浏览器就要与服务器建立一个http连接，因此要用到http协议。http生成一个get请求报文，将该报文传给TCP层处理，所以还会用到TCP协议。如果采用https还会使用ssl协议先对http数据进行加密。

TCP的数据包然后会发送给IP层，用到IP协议。IP层通过路由选路，一跳一跳发送到目的地址。当然在一个网段内的寻址是通过以太网协议实现，同一网段查询目的IP地址的物理地址，需要ARP协议。

#### tcp连接建立过程

第一次握手：客户端发送SYN包至服务器，seq为随机值x,并进入SYN_SENT状态，等待服务器确认

第二次握手：服务器收到客户端的SYN包，发送一个ACK包,标志位ack和syn都为1，seq随机值=y,ack=x+1此时服务器进入SYN_RCVD状态

第三次握手：客户端接收到服务器发送的SYN+ACK后，进入ESTABLISHED状态，并发送确认ACK包，ack=y+1服务器接收到客户端ACK后，进入ESTABLISHED状态

ack=对方的seq+1+对方的syn包len

#### tcp连接关闭过程

第一次挥手：主动关闭方发送一个FIN+ACK包并进入FIN_WAIT1状态。

第二次挥手：被动关闭方接收到主动关闭方发送的FIN并发送ACK，此时被动关闭方进入CLOSE_WAIT状态；主动关闭方收到被动关闭方的ACK后，进入FIN_WAIT2状态。

第三次挥手：被动关闭方发送一个FIN并进入LAST_ACK状态。

第四次挥手：主动关闭方收到被动关闭方发送的FIN并发送ACK，此时主动关闭方进入TIME_WAIT状态，经过2MSL(最大段生存期)时间后关闭连接；被动关闭方收到主动关闭方的ACK后，关闭连接。

#### tcp可靠性保证

##### 1、校验和

tcp维持一个强制的校验和，通过校验和的方式，接收端可以检测出来数据是否有差错和异常，假如有差错就会直接丢弃TCP段，重新发送。TCP在计算校验和时，会在TCP首部加上一个12字节的伪首部（包含ip首部的一些字段）。检验和总共计算3部分：TCP首部、TCP数据、TCP伪首部

##### 2、序列号/确认应答

使用序列号，接收端可以丢弃重复报文，并保证次序。当TCP接收到另一端的数据会发送一个ACK。一个序列号为N的ACK指示着直到N的所有字节已经被成功接收。

##### 3、超时重传

当TCP发送一组报文段时会设置一个重传计时器，超过设定时间没有收到ACK的数据包会被重传。时间的设定根据估算的RTT（往返时间）值。

##### 4、滑动窗口

一种流量控制的机制，发送方不必每发一个分组就停下来等待确认，因此可以加速数据的传输，同时接收方也可以控制发送方的发送速度，避免淹没自己的接收缓冲区。发送窗口允许发送方在停止并等待接收确认报文前可以连续发送多个分组，发送窗口只有收到对端对于本段发送窗口内字节的ACK确认，才会移动发送窗口的左边界。接收窗口只有在前面所有的段都确认的情况下才会移动左边界。接收窗口大小取决于本端软硬件限制，发送窗口大小为接收窗口大小和拥塞窗口大小中的较小者。

快速重传：当接收方接收到失序分组时，立即发送对丢失报文的请求ack，发送方连续收到3个相同ack就立即重传该报文。

##### 5、拥塞控制

拥塞窗口的慢启动机制：慢启动，窗口大小从1开始，以2为指数增长；拥塞避免机制，到达阈值时线性增长。当出现超时重传，阈值变为此时拥塞窗口的一半，窗口重新慢启动。

快速恢复，配合快速重传，当重传发生，阈值设为当前拥塞窗口值的一半，启动值为阈值，即开始线性增长。

#### http2特点

##### 1、二进制分帧

所有的报文被拆分封装成更小的消息单元帧，并进行二进制编码。二进制协议的解析效率高；二进制协议没有冗余字段，占用带宽少；压缩及Https技术弱化了文本协议的价值。

##### 2、首部压缩

使用hpack算法，在浏览器和服务端两端，维护一份相同的字典，用索引号表示重复的字符串，然后采用哈夫曼编码来压缩整数和字符串。其中静态字典，包含常见的首部部名称，以及特别常见的首部名称与值的组合；动态字典，可以动态地添加内容。

##### 3、多路复用

多路复用允许单一的 HTTP/2 连接同时发起多重的请求-响应消息。单连接多资源的方式，减少服务端的链接压力,内存占用更少,连接吞吐量更大；由于减少TCP 慢启动时间，提高传输的速度。二进制帧可以乱序发送。

##### 4、服务器端推送

服务器不再是完全被动地响应请求，也可以主动向客户端发送消息。

#### https

基于HTTP协议，通过SSL或TLS提供加密处理数据、验证对方身份以及数据完整性保护。

特点：

1、结合使用非对称加密和对称加密技术。

非对称加密指的是：加密和解密使用不同的秘钥，一把作为公开的公钥，另一把作为私钥。公钥加密的信息，只有私钥才能解密。私钥加密的信息，只有公钥才能解密。对称加密指的就是加密和解密使用同一个秘钥，对称加密只有一个秘钥。

客户端使用对称加密生成密钥对传输数据进行加密，然后使用非对称加密的公钥再对秘钥进行加密，所以网络上传输的数据是被秘钥加密的密文和用公钥加密后的秘密秘钥，因此即使被黑客截取，由于没有私钥，无法获取到加密明文的秘钥，便无法获取到明文数据。

2、验证身份：客户端通过服务器发来的证书认证服务器的身份。电子证书（ca）包含了通信所用的公钥及颁发权威机构信息。客户端使用本地配置的权威机构的公钥对证书进行解密得到服务端的公钥和证书的数字签名。

3、过程

在tcp连接基础上，会基于ssl再建立一个会话连接，通过这个会话完成服务器认证和加密协商。具体过程，客户端发出请求，包括协议版本，一个随机数和支持的加密方法。服务器回应，内容包括，确认协议版本和加密方法，一个随机数，数字证书。客户端回应，内容包括客户端证书，一个随机数，随机数使用服务器给的公钥加密。根据这三个随机数，客户端和服务器可以组装成协商密钥，通过协商秘钥来进行数据的加密传输。

#### tcp与udp区别

##### 1、连接

TCP是面向连接的传输层协议，即传输数据之前必须先建立好连接。UDP无连接。

##### 2、可靠性

TCP是可靠交付：无差错，不丢失，不重复，按序到达。UDP是尽最大努力交付，提供差错检测，是不可靠传输。

##### 4、拥塞控制，流量控制

TCP有拥塞控制和流量控制来避免网络拥塞，提高传输稳定性。UDP没有拥塞控制。

##### 5、报文长度

TCP会自动分片，根据mss（最大分段大小），mss基于mtu（最大传输单元），目的是重传。UDP面向报文，不合并，不拆分，保留上面传下来报文的边界。

##### 6、首部大小

TCP，首部20个字节。UDP首部8字节，更小。

##### 7、传输方式

tcp是流模式的协议，其传输面向字节流，需要上层协议来划分数据边界。udp是面向报文的传输，以udp包为传输单位。

##### 8、适用场景

要求数据传输可靠稳定，则应该选用TCP 协议（如文件传输、重要状态的更新等）；要求实时性，则使用 UDP 协议（如视频传输、实时通信等）。

#### time_wait

当TCP执行主动关闭，并发出最后一个ACK，该链接必须在TIME_WAIT状态下停留的时间为2MSL。这样可以（1）保证TCP的可靠的全双工连接的终止。（2）等待旧的数据包在网络因过期而消失

#### tcpdump

#### session和cookie

session